<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catch the Offer Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"> 
  <style>
    /* same CSS as before, no major change needed */
    body {
      background: url('background .jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', Arial, sans-serif;
      margin: 0;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .header-buttons {
      position: absolute;
      top: 10px;
      right: 20px;
      display: flex;
      gap: 15px;
    }

    .header-buttons img {
      width: 40px;
      height: 40px;
      cursor: pointer;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px;
      transition: transform 0.2s;
    }

    .header-buttons img:hover {
      transform: scale(1.1);
    }

    .center-text {
      text-align: center;
    }

    .center-text img {
      display: block;
      margin: 0 auto 10px;
    }

    .play-button {
      max-width: 160px;
      height: auto;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }

    #cart-popup, #account-box {
      position: fixed;
      top: 20%;
      right: 20px;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 20px;
      border-radius: 10px;
      display: none;
      width: 250px;
      max-height: 300px;
     box-shadow: 0 0 15px #ffff00;
      z-index: 100;
    }

    #cart-popup h3, #account-box h3 {
      margin-bottom: 10px;
      border-bottom: 1px solid #aaa;
    }

  #cart-popup ul {
  list-style: none;
  padding: 0;
  max-height: 180px;
  overflow-y: auto;
}


    #cart-popup li {
      margin-bottom: 5px;
    }

    #cart-popup button, #account-box button {
      margin-top: 10px;
      background: #FF6699;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
    .redeem-btn {
  margin-left: 10px;
  padding: 3px 8px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.redeem-btn:hover {
  background-color: #45a049;
}

  </style>
</head>
<body>

  <!-- Header Buttons -->
  <div class="header-buttons">
    <img src="user button.png" alt="Account" onclick="showAccount()" title="Account">
    <img src="cart button.png" alt="Cart" onclick="toggleCart()" title="Cart">
  </div>

  <!-- Center Content -->
  <div class="center-text">
    <img src="logo.png" alt="Catch the Offer" style="max-width: 300px;" />
    <a href="game.html">
      <img src="play last.png" alt="Play" class="play-button" />
    </a>
  </div>

  <!-- Cart Popup -->
  <div id="cart-popup">
    <h3>Cart Items</h3>
    <ul id="cart-list"></ul>
    <button onclick="closeCart()">Close</button>
  </div>

  <!-- Account Popup -->
  <div id="account-box">
    <h3>User Details</h3>
    <p id="account-details"></p>
    <button onclick="closeAccount()">Close</button>
  </div>

<script>
  // üõ°Ô∏è Redirect if user not logged in
const storedData = JSON.parse(localStorage.getItem("currentUser"));
if (!storedData || !storedData.username || !storedData.mobile) {
  window.location.href = "login.html";
}

const userData = storedData;

function showAccount() {
  document.getElementById("cart-popup").style.display = "none";
  const box = document.getElementById("account-box");
  const details = document.getElementById("account-details");
  details.innerHTML = `Name: ${userData.username}<br>Phone: ${userData.mobile}`;
  box.style.display = "block";
}

function closeAccount() {
  document.getElementById("account-box").style.display = "none";
}

function toggleCart() {
  document.getElementById("account-box").style.display = "none";

  const popup = document.getElementById("cart-popup");
  const list = document.getElementById("cart-list");
  list.innerHTML = "";

  const mobile = userData?.mobile || "";
  const rewardKey = `caughtOffers_${mobile}`;
  const caughtOffers = JSON.parse(localStorage.getItem(rewardKey) || "[]");

  if (caughtOffers.length === 0) {
    list.innerHTML = "<li>Your cart is empty!</li>";
  } else {
    caughtOffers.forEach((item, index) => {
      const li = document.createElement("li");

const alreadyRedeemed = caughtOffers.some(offer => offer.redeemed);

let buttonHTML = "";
if (!alreadyRedeemed) {
  buttonHTML = `
    <button onclick="redeemOffer('${item.type}', ${index})"
      style="margin-left: 10px; padding: 4px 8px; font-size: 13px;
      background-color: #28a745; color: white; border: none;
      border-radius: 4px; cursor: pointer;">Redeem</button>
  `;
} else if (item.redeemed) {
  buttonHTML = `
    <button disabled
      style="margin-left: 10px; padding: 4px 8px; font-size: 13px;
      background-color: #999; color: white; border: none;
      border-radius: 4px; cursor: default;">Redeemed</button>
  `;
}

li.innerHTML = `${index + 1}. ${item.label} - ${item.value || ""} ${buttonHTML}`;

      list.appendChild(li);
    });
  }

  popup.style.display = "block";
}

function closeCart() {
  document.getElementById("cart-popup").style.display = "none";
}

// üéØ Reward logic (where you push to caughtOffers)
function handleRewardCatch(type, currentLevel) {
  const userMobileKey = `caughtOffers_${userData.mobile}`;
  let caught = JSON.parse(localStorage.getItem(userMobileKey) || "[]");

  if (type === 'pizza') {
    caught.push({ type: "dominos", label: "Dominos Reward", value: "5% OFF" });
    pizzaRewardBox.style.display = "flex";
  } else if (type === 'meesho') {
    caught.push({ type: "meesho", label: "Meesho Trend Offer", value: "7% OFF" });
    meeshoRewardBox.style.display = "flex";
  } else if (type === 'zepto') {
    caught.push({ type: "zepto", label: "Zepto Grocery Deal", value: "10% OFF" });
    zeptoRewardBox.style.display = "flex";
  } else if (type === 'job') {
    caught.push({ type: "job", label: "Career Boost Deal", value: "Premium Offer" });
    if (currentLevel === 11) {
      gameEnded = true;
      document.getElementById("finalCongratsScreen").style.display = "flex";
    } else {
      jobRewardBox.style.display = "flex";
    }
  }

  localStorage.setItem(userMobileKey, JSON.stringify(caught));
}

function redeemOffer(type, index) {
  const mobile = userData?.mobile || "";
  const rewardKey = `caughtOffers_${mobile}`;
  let caughtOffers = JSON.parse(localStorage.getItem(rewardKey) || "[]");

  // Mark the selected reward as redeemed
  caughtOffers[index].redeemed = true;

  // Save back to localStorage
  localStorage.setItem(rewardKey, JSON.stringify(caughtOffers));

  alert(`You redeemed the ${type.toUpperCase()} offer!`);

  // Disable all other redeem buttons
  const allButtons = document.querySelectorAll('#cart-list button');
  allButtons.forEach((btn, i) => {
    if (i !== index) {
      btn.remove(); // Remove other redeem buttons
    } else {
      btn.disabled = true; // Disable this one
      btn.textContent = "Redeemed";
      btn.style.backgroundColor = "#999";
      btn.style.cursor = "default";
    }
  });
}


</script>


</body>
</html>
